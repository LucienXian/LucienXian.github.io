<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="LucienXian's Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="LucienXian&#39;s Garden">
<meta property="og:type" content="website">
<meta property="og:title" content="LucienXian&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/page/27/index.html">
<meta property="og:site_name" content="LucienXian&#39;s Blog">
<meta property="og:description" content="LucienXian&#39;s Garden">
<meta property="og:locale">
<meta property="article:author" content="LucienXian">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/27/"/>





  <title>LucienXian's Blog</title>
  














<meta name="generator" content="Hexo 6.3.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">LucienXian's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-/tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/12/%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LucienXian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/12/%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B/" itemprop="url">进程与线程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-12T10:58:10+08:00">
                2017-11-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="进程与线程">进程与线程</h1>
<h2 id="定义">定义</h2>
<h3 id="进程">进程</h3>
<p>一个具有一定独立功能的程序在一个数据集合上的一次动态执行过程；一个进程由这些部分组成：PC；寄存器；stack；heap；data
section；</p>
<h3 id="线程">线程</h3>
<p>CPU调度的最小单元。一个线程包括：thread ID；PC；寄存器集；stack。</p>
<h2 id="区别">区别</h2>
<blockquote>
<ol type="1">
<li>进程具有独立的地址空间，而同一个进程下的线程则共享进程的地址空间；由于建立进程时，需要分配数据块，栈块和代码块等来维护这个进程，而线程则共享大部分数据，甚至可以访问进程的每一块内存，所以进程的创立和切换都是比较昂贵的工作模式，而线程则相对轻量；</li>
<li>线程的通信会更加方便，这也是建立在线程共享大部分数据的基础上。而且，一个线程建立的heap能被同一进程下的其它线程访问；</li>
<li>多进程比多线程健壮，大多数情况下，一个线程挂了整个进程都会挂了，而进程则是独立的。</li>
<li>多线程与多进程：多进程需要开辟更多的独立空间，消耗大量的资源；多线程则是共享数据，轻量级并发。对于需要频繁交互数据，或者是高并发的情况下，用多线程；而不需要频繁交互数据的并发编程则用多进程。</li>
</ol>
</blockquote>
<h1 id="进程-1">进程</h1>
<h2 id="进程状态">进程状态</h2>
<p>进程有五种状态：new、ready、running、waiting、terminate。</p>
<p>状态变化如下：</p>
<figure>
<img src="http://ou7boskhm.bkt.clouddn.com/process_state.png"
alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<h2 id="组成进程的部分">组成进程的部分</h2>
<ul>
<li>program code、data</li>
<li>PCB：stack、os的资源、registers</li>
</ul>
<h3 id="pcb">PCB</h3>
<p>进程控制块：每个进程都信息相关：</p>
<ul>
<li>process state;</li>
<li>program counter;</li>
<li>CPU registers;</li>
<li>CPU scheduling info;</li>
<li>memory-management info;</li>
<li>accounting info;</li>
<li>file management;</li>
<li>IO status info;</li>
</ul>
<blockquote>
<p>在linux里，在头文件<strong>sched.h</strong>中的task_struct存着进程的有关信息。</p>
</blockquote>
<h2 id="pid">pid</h2>
<p>以unix为例，fork()之后，父进程与子进程具有相同上下文。</p>
<p>在子进程中，fork()返回值为0；在父进程中，pid()返回值为子进程的pid号。</p>
<h2 id="进程间通信">进程间通信</h2>
<p>通信机制：</p>
<ul>
<li>信号量：用来实现进程间的同步与互斥，但不能存储通信数据；</li>
<li>消息队列：由链表，存放在内核中并由消息队列标识符标识。</li>
<li>共享内存：能实现内存被多个进程共享；</li>
<li>管道(pipe)：半双工的通信方式，单向通信，而且只能在具有亲缘关系的进程间通信；</li>
<li>命名管道：同样半双工，但允许非亲缘关系的进程通信；</li>
<li>信号：通知某个进程事件的发生；</li>
<li>套接字；</li>
</ul>
<h1 id="线程-1">线程</h1>
<h2 id="user与kernel-线程">user与kernel 线程</h2>
<blockquote>
<p>user 线程：</p>
<p>用户线程由应用进程进行维护；</p>
<p>内核不知道用户线程的存在；</p>
<p>用户线程的切换不需要内核特权；</p>
<p>如果用户现场发起系统调用而阻塞了，则整个进程都在等待；</p>
</blockquote>
<blockquote>
<p>kernel 线程：</p>
<p>内核维护进程和线程的上下文；</p>
<p>线程的切换由内核完成；</p>
<p>时间片会由CPU分配给线程，因此多线程的进程会获得更多的CPU时间；</p>
<p>一个线程阻塞，不会影响其他线程的运行；</p>
</blockquote>
<ul>
<li>比较：
<ul>
<li>用户线程由于不用陷入内核，所以切换速度更快；</li>
<li>用户线程允许用户进程自定义调度算法；</li>
<li>用户线程跨平台会更容易；</li>
<li>用户线程难以解决阻塞的问题；</li>
<li>用户线程由于没有时钟，难以调度；</li>
</ul></li>
</ul>
<h2 id="linux下的使用">linux下的使用</h2>
<p>四个常用函数：pthread_create; pthread_join; pthread_self;
pthread_exit;</p>
<h1 id="同步与互斥">同步与互斥</h1>
<ul>
<li>互斥是指在同一时间只允许一个访问者进行访问，具有唯一性和排他性；</li>
<li>同步是指在实现互斥的基础上，通过某些机制实现访问者对资源的有序访问；</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/11/static%E7%9A%84%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94CPP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LucienXian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/11/static%E7%9A%84%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94CPP/" itemprop="url">static的学习——CPP</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-11T22:03:41+08:00">
                2017-11-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="static的学习cpp">static的学习——CPP</h1>
<h2 id="作用">作用</h2>
<blockquote>
<ol type="1">
<li>延长生命周期</li>
<li>限制作用域</li>
<li>唯一性</li>
</ol>
</blockquote>
<h2 id="修饰局部变量">修饰局部变量</h2>
<h3 id="存储区域">存储区域</h3>
<p>static在修饰局部变量时，被修饰的变量存储在静态存储区（与之对应的非静态局部变量则存储在栈中，栈的分配比静态存储区快）。</p>
<h3 id="生命周期">生命周期</h3>
<p>局部静态变量，即便在退出所在函数之后也不会被销毁。</p>
<ul>
<li>在main()之前static变量已经被初始化；</li>
<li>由系统在程序退出时销毁；</li>
</ul>
<h2 id="修饰全局变量">修饰全局变量</h2>
<h3 id="限制作用域">限制作用域</h3>
<p>对于全局变量，由于全局变量本身就是存储在静态存储区；但是static会限制了它的连接属性。</p>
<p>打个比方：</p>
<blockquote>
<p>假如在头文件中定义了一个全局变量；而一旦这个全局变量被两个.cpp文件include进来了，那么回发送重定义的错误。</p>
</blockquote>
<p>这时有两个解决办法：一个是上一次提到过的使用extern，而另一个则是使用static去修饰定义。由于static全局变量只能被包含它的文件定义，也就是说，static修饰的全局变量是不能被其它文件（非包含该变量的文件）访问，这时两个.cpp中static是不一样的。</p>
<h2 id="修饰函数">修饰函数</h2>
<ul>
<li>对于静态函数，定义和声明要放在一起，不能一个在头文件中，另一个在.cpp文件中。因此，在多人合作的项目中，可以定义static函数，避免冲突。</li>
</ul>
<h2 id="与c的不同">与C的不同</h2>
<p>由于CPP类的出现，如果类中定义static的成员变量和函数，那么所有对象都共享一个实例。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/10/extern%E7%9A%84%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94CPP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LucienXian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/10/extern%E7%9A%84%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94CPP/" itemprop="url">extern的学习——CPP</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-10T23:24:16+08:00">
                2017-11-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="extern学习">extern学习</h2>
<h3 id="变量声明">变量声明</h3>
<p>由于CPP支持分离式编译，所以如果程序被分成若干个文件，则需要一种方法来保证代码共享。因此，CPP将声明和定义分开，声明使得名字为程序所知，而定义则是创建与该名字相关联的实体。</p>
<p>因此，如果想要声明一个变量，而不是定义它，则在变量名前加上<strong>extern</strong>关键字。如果extern语句中包含初始值，则不再是声明了，而是定义：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="type">int</span> i; <span class="comment">//声明</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">int</span> i = <span class="number">0</span>; <span class="comment">//定义</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：</p>
<ol type="1">
<li>不能在函数里试图初始化一个由extern关键字标记的变量，会造成重定义的错误。</li>
<li>extern时要严格对应声明时的类型，例如：定义的是数组，不可以extern指针。</li>
</ol>
</blockquote>
<p>用法：通常在模块的头文件中对本模块提供给其它模块引用的的函数和全局变量以extern声明，然后其它的模块在使用时只需要include该头文件即可。</p>
<h3 id="extern-c">extern "c"</h3>
<p>CPP程序有时需要调用其他语言编写的函数，最常见的就是调用C语言编写的函数，虽然编译器在处理其调用方式上与CPP相同，但生成的代码会有所区别。<strong>例如CPP为了解决多态性的问题，会将函数名字与参数连在一起生成一个中间函数的名称</strong>，而C语言不会，因此这样会造成编译器找不到该函数。</p>
<p>为了避免这个问题，CPP提供了链接指示，指出如何处理非CPP的语言。常见做法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span>&#123;</span><br><span class="line">　<span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">　<span class="meta">#<span class="keyword">endif</span> <span class="comment">/* __cplusplus */</span> </span></span><br><span class="line">　…</span><br><span class="line">　…</span><br><span class="line">　<span class="comment">//.h文件结束的地方</span></span><br><span class="line">　<span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line">　<span class="meta">#<span class="keyword">if</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">/* __cplusplus */</span></span></span><br></pre></td></tr></table></figure>
<h2 id="参考">参考</h2>
<p>http://www.cnblogs.com/yc_sunniwell/archive/2010/07/14/1777431.html</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/02/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LucienXian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/02/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0-3/" itemprop="url">区块链学习-3</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-02T12:08:59+08:00">
                2017-11-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="共识算法">共识算法</h1>
<p>共识（consensus）与昨天提到的一致性经常是放在一起讨论的，一致性指的是系统的结果状态，共识则是一个手段，过程，解决的是多个节点对某个proposal达成一致意见的过程。</p>
<blockquote>
<p>一般把出现故障但不伪造信息的情况成为“非拜占庭错误”；</p>
<p>出现故障并且伪造信息进行恶意相应的称为“拜占庭错误”，同时对应结点，称为拜占庭节点；</p>
</blockquote>
<p><br></p>
<h2 id="常见算法">常见算法</h2>
<p><br></p>
<h3 id="paxos-算法-与-raft算法">Paxos 算法 与 Raft算法</h3>
<p>Paxos算法将节点分为了三个逻辑角色：</p>
<ul>
<li>proposer:提出一个题案，等待其它结点选择、批准，通常担任该角色的为客户端；每个编号都应该有一个ID，通常是递增ID；</li>
<li>accepter: 负责对题案进行投票，是否接受该题案；</li>
<li>learner:获取投票结果，但不参与投票，可以将投票结果传播到其他地方；</li>
</ul>
<p>基本过程：多个proposer争取到了提出提案的权利，得到权利的proposer发送提案给所有人，得到多数人确认通过的提案会成为最终批准的提案。</p>
<p>为了保证accepter能够获知其它accepter也收到了自己的投票信息，验证自己的投票结果是否构成了大多数的意见，并且proposer能收到自己的投票，该算法得实现两个提交阶段：</p>
<ul>
<li>prepare：
<ul>
<li>有权利的proposer发送自己的提案到accepter；</li>
<li>accepter保留着收到过的提案中最大的编号。如果收到了新的提案，而该提案比保留编号要大，则返回已接受的编号和提案内容，更新当前最大编号，意味着不接受小于当前最大编号的提案；</li>
</ul></li>
<li>commit
<ul>
<li>proposer如果接受到多数的回复，则准备发出带有刚才提案ID的接收消息。如果收到的回复不带有新的提案，则说明锁定成功，可以发送自己的提案内容；如果收到了新的提案内容，则替换提案ID为接受的提案中最大的ID值；如果没有收到回复，则重发；</li>
<li>accepter收到消息之后，发现该提案ID不小于已接受的最大提案ID，则接受该提案，并更新信息；</li>
</ul></li>
<li>一旦多数accepter接受了共同的提案ID，则形成最终决议。</li>
</ul>
<p><br></p>
<p>Raft算法也将服务器节点分为三种逻辑角色：</p>
<ul>
<li>Leader: 处理所有的客户端交互，一次只有一个leader；</li>
<li>Follower: 刚开始集群中所有节点都是follower；</li>
<li>Candidate: 能被宣称leader；</li>
</ul>
<p>基本过程：</p>
<ol type="1">
<li>首先是选举。任何一个follower都能成为一个candidate，成为candidate后向其它的follower发起选举自己的请求，自己也可以投票给自己，一旦票数大于二分之一，则表示通过、达成一致，成为leader；选出leader后，leader需要定期向follower发送信息，表示自己的通知，如果在一定时间内follower没有收到信息，则认为leader宕机，重新选leader；</li>
<li>以日志复制来表现raft算法，假设leader被选出后，此时客户端要求增加一个日志，leader会要求follower将该日志追加到自己的日志记录中去。多数的follower在追加日志成功后，会发出确认信息。然后，leader会通知所有的follower完成commit。</li>
</ol>
<blockquote>
<p>如果在这个过程中，由于网络分区或者故障，leader只能访问部分follower，那么另外一部分的f大多数follower则会选出新的leader，与客户端交互。这个新的leader会按以上步骤通知大多数的follower。此时，如果网络恢复了，旧的leader会变成follower，此时旧的leader的更新都必须回滚，从新的leader处同步所有数据。</p>
</blockquote>
<p>其它一致性的保障可以参考：http://www.cnblogs.com/mindwind/p/5231986.html</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/31/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LucienXian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/31/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0-2/" itemprop="url">区块链学习-2</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-31T23:33:15+08:00">
                2017-10-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="区块链学习-一致性问题">区块链学习<二> 一致性问题</h1>
<p><br></p>
<p>由于区块链系统是一个分布式系统，因此一致性问题是实现基于该系统上的业务必须有所保障的。</p>
<p><br></p>
<h2 id="定义">定义</h2>
<p>一致性（consistency），是指对于分布式系统中的多个服务节点，在给定一系列操作之后，在事先约定的协议保障下，对操作结果达成认同，系统对外呈现出一致的状态。</p>
<p><br></p>
<h2 id="问题">问题</h2>
<ul>
<li>服务节点间的网络通信会在一定程度上出现消息延迟、乱序和内容不正确等；</li>
<li>同步调用会降低分布式系统的扩展性，使其退化为单节点系统；</li>
<li>无法保障节点的处理时间；</li>
</ul>
<blockquote>
<p>然而，如今处理分布式系统一致性的思路普遍集中在将可能发生不一致的并行操作进行串行化</p>
</blockquote>
<h2 id="特点">特点</h2>
<ul>
<li>termination：操作必须要在一定时间内得出结果；</li>
<li>agreement：决策结果相同，这多数体现在分布式系统对transaction进行排序，并且所排顺序得到大家认可；</li>
<li>validity：transaction必须由某个节点提出；</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/30/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LucienXian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/30/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0-1/" itemprop="url">区块链学习<1></a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-30T23:29:16+08:00">
                2017-10-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="区块链学习-核心技术概览">区块链学习<一> 核心技术概览</h1>
<p><br></p>
<h2 id="定义与原理">定义与原理</h2>
<blockquote>
<p>区块链最早出现应用在比特币项目中，作为比特币背后的分布式记账平台。</p>
</blockquote>
<ul>
<li>transaction：一次对账本的操作，导致账本状态的改变；</li>
<li>block：记录着一段时间内交易状态和结果；</li>
<li>chain：由block按照发生顺序连接而成，相当于账本的日志记录；</li>
</ul>
<p><br></p>
<p>假设存在一个分布式的记账本，这个账本只允许添加，不允许删除。而这个账本的底层数据结构是由一个线性链表组成的，其中每个元素即block。后续block的加入要加入前一个block的信息，并必须得到共识机制来选择。</p>
<p>任何结点都可以提一个区块。</p>
<p><br></p>
<h2 id="特点">特点</h2>
<p>基于区块链的分布式账本应具备以下特点：</p>
<ul>
<li>维护一条不断增长的链，只能添加，禁止删除；</li>
<li>去中心化，避免集中控制，达成共识过程采用分布式的做法；</li>
<li>基于密码学的特性来避免交易被破坏；</li>
</ul>
<p><br></p>
<h2 id="分布式共识">分布式共识</h2>
<p>其实这个。。。我也不大懂，大概意思就是怎样确保某个transaction能在分布式网络中得到一致的、同步的执行结果，而且这个执行结果被多方确认，同时这个执行结果是一旦确定就无法被推翻的。</p>
<p>目前学术界和工业界大概确定了两类算法思想：</p>
<ul>
<li>基于概率的算法；</li>
<li>确定性算法；</li>
</ul>
<h2 id="性能">性能</h2>
<p>区块链衡量性能的指标主要以<strong>transactions per
second</strong>即<strong>tps</strong>为主，区块链系统不能通过单纯增加结点来进行扩展，很大程度上取决于单个节点的处理能力，因为当节点数过多时，可能会因为一致性的达成过程所需时间过长而降低全网的性能。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/28/chaincode-lifecycle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LucienXian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/28/chaincode-lifecycle/" itemprop="url">chaincode_lifecycle</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-28T10:29:10+08:00">
                2017-10-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>先附上一张早上刚刚“新鲜出炉”的<strong>chaincode</strong>生命周期的流程图，欢迎指教；</p>
<figure>
<img src="http://ou7boskhm.bkt.clouddn.com/chaincode_life_image.png"
alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p><br></p>
<h1 id="四种声明周期">四种声明周期</h1>
<p>Chaincode
的生命周期有四种：package、install、instantiate、upgrade</p>
<h2 id="package">Package</h2>
<ul>
<li><ul>
<li>CDS根据代码和其他属性（名字和版本）定义chaincode包</li>
</ul></li>
<li><ul>
<li><p>实例化政策能在endorsement政策中描述</p></li>
<li><p>拥有chaincode的实体进行签名</p></li>
<li><ul>
<li>签名目的：建立chaincode的所有者、验证包的内容，防止被篡改</li>
</ul></li>
<li><p>Create package</p></li>
<li><ul>
<li><p>两种方法：</p></li>
<li><ul>
<li>一种是我们希望该chaincode有多个owner，因此需要创建一个可以被前面的chaincode包（signerCDS），然后按顺序地被每个owner签名；</li>
<li>另一种则是仅部署具有发出安装事物的结点签名的signedCDS</li>
</ul></li>
<li><p>signerCDS包含3个元素</p></li>
<li><ul>
<li>源码，名字和版本（即CDS）</li>
<li>实例化策略</li>
<li>chaincode的所有者，由endorsement定义</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<p><br></p>
<h2 id="install">Install</h2>
<ul>
<li>安装事务将源码组装成CDS的格式，然后install到运行该chaincode的结点上；</li>
<li>只有chaincode的拥有者拥有的结点能执行chaincode，其它的结点可以验证和提交；</li>
<li>安装chaincode的时候，会发送一个signer protocol到lifecycle system
chaincode（LSCC）；</li>
</ul>
<p><br></p>
<h2 id="instantiate">Instantiate</h2>
<ul>
<li>实例化事务通过调用LSCC来创建和实例化一个chaincode到channel上；</li>
<li>chaincode可以安装到多个channel上，它们相互之间是独立的；</li>
<li>默认的实例化策略：链码实例化事物的创建者必须是channel管理员的成员；</li>
<li>实例化事物的创建者必须满足signedCDS中的实例化策略，并且还是channel的writer；否则，会有可能出现恶意实体部署chaincode到未绑定的channel上或者欺骗成员在未绑定的channel上执行链码；</li>
<li>transaction到达endorser时，endorser根据实例化策略来验证创建者的签名；在提交大账本前，也会再做一次验证；</li>
<li>实例化事物也会设立一个endorsement
policy，这个策略用来被channel其它成员去接受，认可；</li>
</ul>
<p><br></p>
<blockquote>
<p>经过上述三个周期，chaincode进入活跃状态；</p>
</blockquote>
<p><br></p>
<h2 id="upgrade">upgrade</h2>
<ul>
<li>chaincode名必须要一样；</li>
<li>新的chaincode在安装、实例化到一个channel上时，其它绑定了旧的chaincode仍然运行旧的版本；</li>
<li>（旧的版本与新的版本可能共存，所以需要我们手动删除）</li>
<li>与实例化事物不一样，检查upgrade事务是根据当前chaincode的实例化策略，而不是新的策略，这是为了保证只有当前chaincode实例化策略的成员才能upgrade</li>
</ul>
<h2 id="关于stop与start">关于stop与start</h2>
<blockquote>
<p>据说新版本会推出stop与start两种生命周期的管理，拭目以待；</p>
</blockquote>
<ul>
<li><p>没有停止和启动生命周期</p></li>
<li><ul>
<li>只能从每个endorser中删除signedCDS，然后从承载对等节点运行的主机或者虚拟机里删除chaincode的容器</li>
</ul></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/25/OpenGL%E7%9A%84%E7%9F%A9%E9%98%B5%E4%BD%BF%E7%94%A8%E2%80%94%E2%80%94%E7%BB%98%E5%88%B6%E6%A1%8C%E5%AD%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LucienXian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/25/OpenGL%E7%9A%84%E7%9F%A9%E9%98%B5%E4%BD%BF%E7%94%A8%E2%80%94%E2%80%94%E7%BB%98%E5%88%B6%E6%A1%8C%E5%AD%90/" itemprop="url">OpenGL的矩阵使用——绘制桌子</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-25T21:09:16+08:00">
                2017-10-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="要求">要求</h1>
<p>其中最左边的桌子循环上移（即匀速上移到一定位置后回到原点继续匀速上移），中间的桌子不断旋转(即绕自身中间轴旋转)，最右边的桌子循环缩小（即不断缩小到一定大小后回归原来大小继续缩小）。</p>
<figure>
<img src="http://ou7boskhm.bkt.clouddn.com/desk1.png" alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p>桌子的模型尺寸如下：</p>
<figure>
<img src="http://ou7boskhm.bkt.clouddn.com/desk2.png" alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p><br></p>
<h1 id="操作方法和实验步骤">操作方法和实验步骤</h1>
<h2 id="绘制桌子">绘制桌子</h2>
<p>根据题目要求，主要实现的是桌子的移动、旋转和缩放，因此首先需要绘制出桌子的形状。</p>
<p>由于题目要求的桌子主要由五个立法体组成，分别是一个桌面和四个桌脚，而立方体又是由6个面组成的，因此通过绘制模式<strong>GL_QUAD</strong>绘制所有的面即可；如图：</p>
<figure>
<img src="http://ou7boskhm.bkt.clouddn.com/desk3.png" alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p>一个立方体的大小和位置有中心点位置和长宽高决定（假设中点位置坐标为x、y、z），因此我们可以得到四个面、二十四个点的位置为：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123; x + width,y + depth,z &#125;,&#123; x + width,y - depth,z &#125;,&#123; x - width,y - depth,z &#125;,&#123; x - width,y + depth,z &#125;,</span><br><span class="line"></span><br><span class="line">&#123; x - width,y + depth,z &#125;,&#123; x - width,y - depth,z &#125;,&#123; x - width,y - depth,z - height &#125;,&#123; x - width,y + depth,z - height &#125;,</span><br><span class="line"></span><br><span class="line">&#123; x - width,y + depth,z - height &#125;,&#123; x - width,y - depth,z - height &#125;,&#123; x + width,y - depth,z - height &#125;,&#123; x + width,y + depth,z - height &#125;,</span><br><span class="line"></span><br><span class="line">&#123; x + width,y + depth,z - height &#125;,&#123; x + width,y - depth,z - height &#125;,&#123; x + width,y - depth,z &#125;,&#123; x + width,y + depth,z &#125;,</span><br><span class="line"></span><br><span class="line">&#123; x + width,y + depth,z &#125;,&#123; x - width,y + depth,z &#125;,&#123; x - width,y + depth,z - height &#125;,&#123; x + width,y + depth,z - height &#125;,</span><br><span class="line"></span><br><span class="line">&#123; x + width,y - depth,z &#125;,&#123; x - width,y - depth,z &#125;,&#123; x - width,y - depth,z - height &#125;,&#123; x + width,y - depth,z - height &#125;</span><br></pre></td></tr></table></figure>
<p>设置多边形的绘制模式为<strong>glPolygonMode(GL_FRONT_AND_BACK,GL_LINE)</strong>，绘制出立方体来：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">glBegin</span>(GL_QUADS);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">24</span>; i++)</span><br><span class="line">		<span class="built_in">glVertex3f</span>(point[i][<span class="number">0</span>], point[i][<span class="number">1</span>],point[i][<span class="number">2</span>]);</span><br><span class="line"><span class="built_in">glEnd</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>最后把绘制立方体的过程封装成函数，传入中心点位置和长宽高即可绘制出桌子;</p>
<p><br></p>
<h2 id="桌子循环上移旋转缩小放大">桌子循环上移、旋转、缩小放大</h2>
<p>循环上移通过函数<strong>glTranslatef</strong>、<strong>glRotate</strong>、<strong>glScale</strong>完成桌子移动、旋转和缩放的操作；这几个函数的操作原理是将当前的栈顶矩阵乘以一个操作矩阵（移动、旋转、缩放），因此每次绘制前我们都需要通过<strong>glLoadIdentity()</strong>将当前的操作矩阵矩阵重置为单位矩阵；然在具体的移动或旋转或缩放操作时，将操作矩阵压进栈中，避免这三个操作相互影响；</p>
<p><br></p>
<h3 id="移动">移动</h3>
<blockquote>
<p>void glTranslatef(GLfloatx,GLfloat y,GLfloat z);</p>
<p>函数功能： 沿X轴正方向平移x个单位</p>
<p>​ 沿Y轴正方向平移y个单位</p>
<p>​ 沿Z轴正方向平移z个单位</p>
</blockquote>
<figure>
<img src="http://ou7boskhm.bkt.clouddn.com/desk4.png" alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<h3 id="旋转">旋转</h3>
<blockquote>
<p>void glRotatef(GLfloatangle,GLfloat x,GLfloat y,GLfloat z);</p>
<p>函数功能：以点(0,0,0)到点(x,y,z)为轴，旋转angle角度；</p>
</blockquote>
<figure>
<img src="http://ou7boskhm.bkt.clouddn.com/desk5.png" alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p>根据题目要求，绕着y轴旋转，即用右手握住这条y轴向量，大拇指指向向量的正方向，四指环绕的方向就是旋转的方向；</p>
<h3 id="缩放">缩放</h3>
<blockquote>
<p>void glScalef(GLfloat Sx, GLfloat Sy, GLfloat Sz);</p>
<p>函数功能：Sx,Sy,Sz分别为模型在x,y,z轴方向的缩放比；</p>
</blockquote>
<figure>
<img src="http://ou7boskhm.bkt.clouddn.com/desk6.png" alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p><br></p>
<h1 id="源代码">源代码</h1>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;glut.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">float</span> fTranslate;</span><br><span class="line"><span class="type">float</span> fRotate;</span><br><span class="line"><span class="type">float</span> fScale = <span class="number">1.0f</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Draw_Cube</span><span class="params">(GLfloat x, GLfloat y , GLfloat z,GLfloat width_, GLfloat depth_, GLfloat height_)</span> </span>&#123;</span><br><span class="line">	GLfloat width = width_ * <span class="number">0.5</span>;</span><br><span class="line">	GLfloat depth = depth_ * <span class="number">0.5</span>;</span><br><span class="line">	GLfloat height = height_;</span><br><span class="line">	<span class="comment">//calculate all the points</span></span><br><span class="line">	GLfloat point[<span class="number">24</span>][<span class="number">3</span>] = &#123;</span><br><span class="line">		&#123; x + width,y + depth,z &#125;,&#123; x + width,y - depth,z &#125;,&#123; x - width,y - depth,z &#125;,&#123; x - width,y + depth,z &#125;,</span><br><span class="line">		&#123; x - width,y + depth,z &#125;,&#123; x - width,y - depth,z &#125;,&#123; x - width,y - depth,z - height &#125;,&#123; x - width,y + depth,z - height &#125;,</span><br><span class="line">		&#123; x - width,y + depth,z - height &#125;,&#123; x - width,y - depth,z - height &#125;,&#123; x + width,y - depth,z - height &#125;,&#123; x + width,y + depth,z - height &#125;,</span><br><span class="line">		&#123; x + width,y + depth,z - height &#125;,&#123; x + width,y - depth,z - height &#125;,&#123; x + width,y - depth,z &#125;,&#123; x + width,y + depth,z &#125;,</span><br><span class="line">		&#123; x + width,y + depth,z &#125;,&#123; x - width,y + depth,z &#125;,&#123; x - width,y + depth,z - height &#125;,&#123; x + width,y + depth,z - height &#125;,</span><br><span class="line">		&#123; x + width,y - depth,z &#125;,&#123; x - width,y - depth,z &#125;,&#123; x - width,y - depth,z - height &#125;,&#123; x + width,y - depth,z - height &#125;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBegin</span>(GL_QUADS);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">24</span>; i++)</span><br><span class="line">		<span class="built_in">glVertex3f</span>(point[i][<span class="number">0</span>], point[i][<span class="number">1</span>],point[i][<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">glEnd</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Draw_Dest</span><span class="params">()</span> <span class="comment">// This function draws a triangle with RGB colors</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">Draw_Cube</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0.8</span>, <span class="number">0.2</span>); <span class="comment">//桌面</span></span><br><span class="line">	<span class="built_in">Draw_Cube</span>(<span class="number">0.3</span>, <span class="number">0.2</span>, <span class="number">-0.2</span>, <span class="number">0.2</span>, <span class="number">0.2</span>, <span class="number">0.6</span>);<span class="comment">//桌脚</span></span><br><span class="line">	<span class="built_in">Draw_Cube</span>(<span class="number">-0.3</span>, <span class="number">0.2</span>, <span class="number">-0.2</span>, <span class="number">0.2</span>, <span class="number">0.2</span>, <span class="number">0.6</span>);</span><br><span class="line">	<span class="built_in">Draw_Cube</span>(<span class="number">0.3</span>, <span class="number">-0.2</span>, <span class="number">-0.2</span>, <span class="number">0.2</span>, <span class="number">0.2</span>, <span class="number">0.6</span>);</span><br><span class="line">	<span class="built_in">Draw_Cube</span>(<span class="number">-0.3</span>, <span class="number">-0.2</span>, <span class="number">-0.2</span>, <span class="number">0.2</span>, <span class="number">0.2</span>, <span class="number">0.6</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">reshape</span><span class="params">(<span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (height==<span class="number">0</span>)										<span class="comment">// Prevent A Divide By Zero By</span></span><br><span class="line">	&#123;</span><br><span class="line">		height=<span class="number">1</span>;										<span class="comment">// Making Height Equal One</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glViewport</span>(<span class="number">0</span>,<span class="number">0</span>,width,height);						<span class="comment">// Reset The Current Viewport</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">glMatrixMode</span>(GL_PROJECTION);						<span class="comment">// Select The Projection Matrix</span></span><br><span class="line">	<span class="built_in">glLoadIdentity</span>();									<span class="comment">// Reset The Projection Matrix</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Calculate The Aspect Ratio Of The Window</span></span><br><span class="line">	<span class="built_in">gluPerspective</span>(<span class="number">45.0f</span>,(GLfloat)width/(GLfloat)height,<span class="number">0.1f</span>,<span class="number">100.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glMatrixMode</span>(GL_MODELVIEW);							<span class="comment">// Select The Modelview Matrix</span></span><br><span class="line">	<span class="built_in">glLoadIdentity</span>();									<span class="comment">// Reset The Modelview Matrix</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">idle</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glutPostRedisplay</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">redraw</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glPolygonMode</span>(GL_FRONT_AND_BACK, GL_LINE);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glLoadIdentity</span>();									<span class="comment">// Reset The Current Modelview Matrix</span></span><br><span class="line">	</span><br><span class="line">	<span class="built_in">glPushMatrix</span>();</span><br><span class="line">		<span class="built_in">glTranslatef</span>(<span class="number">-2.0f</span>, <span class="number">0.0f</span>,<span class="number">-6.0f</span>);		<span class="comment">// Place the triangle Left</span></span><br><span class="line">		<span class="built_in">glTranslatef</span>(<span class="number">0.0f</span>, fTranslate, <span class="number">0.0f</span>);	<span class="comment">// Translate in Y direction</span></span><br><span class="line">		<span class="built_in">Draw_Dest</span>();						<span class="comment">// Draw desk					</span></span><br><span class="line">	<span class="built_in">glPopMatrix</span>();</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glPushMatrix</span>();</span><br><span class="line">		<span class="built_in">glTranslatef</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>,<span class="number">-6.0f</span>);			<span class="comment">// Place the dest at Center</span></span><br><span class="line">		<span class="built_in">glRotatef</span>(fRotate, <span class="number">0</span>, <span class="number">3.0f</span>, <span class="number">0</span>);			<span class="comment">// Rotate around Y axis</span></span><br><span class="line">		<span class="built_in">Draw_Dest</span>();						<span class="comment">// Draw desk</span></span><br><span class="line">	<span class="built_in">glPopMatrix</span>();</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glPushMatrix</span>();</span><br><span class="line">		<span class="built_in">glTranslatef</span>(<span class="number">2.0f</span>, <span class="number">0.0f</span>, <span class="number">-6.0f</span>);			<span class="comment">// Place the dest right</span></span><br><span class="line">		<span class="built_in">glScalef</span>(fScale, fScale, fScale);			<span class="comment">// Scale</span></span><br><span class="line">		<span class="built_in">Draw_Dest</span>();						<span class="comment">// Draw Draw desk</span></span><br><span class="line">	<span class="built_in">glPopMatrix</span>();</span><br><span class="line"></span><br><span class="line">	fScale -= <span class="number">0.005f</span>;</span><br><span class="line">	fTranslate += <span class="number">0.005f</span>;</span><br><span class="line">	fRotate    += <span class="number">0.3f</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (fTranslate &gt; <span class="number">0.5f</span>) fTranslate = <span class="number">0.0f</span>;</span><br><span class="line">	<span class="keyword">if</span> (fScale &lt; <span class="number">0.5f</span>) fScale = <span class="number">1.0f</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glutSwapBuffers</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">processNormalKeys</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> key, <span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (key == <span class="number">27</span>)  <span class="comment">//按ESC退出  </span></span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">(<span class="type">int</span> argc,  <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glutInit</span>(&amp;argc, argv);</span><br><span class="line">	<span class="built_in">glutInitDisplayMode</span>(GLUT_RGBA | GLUT_DOUBLE);</span><br><span class="line">	<span class="built_in">glutInitWindowSize</span>(<span class="number">640</span>,<span class="number">480</span>);                                                  </span><br><span class="line">	<span class="built_in">glutCreateWindow</span>(<span class="string">&quot;Exercise2&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glutDisplayFunc</span>(redraw);</span><br><span class="line">	<span class="built_in">glutReshapeFunc</span>(reshape);		</span><br><span class="line">	<span class="built_in">glutIdleFunc</span>(idle);	</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glutKeyboardFunc</span>(processNormalKeys);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glutMainLoop</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><br></p>
<h1 id="效果">效果</h1>
<figure>
<img src="http://ou7boskhm.bkt.clouddn.com/desk7.png" alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/01/%E5%9F%BA%E4%BA%8Eopengl%E7%BB%98%E5%88%B6%E4%BA%94%E6%98%9F%E7%BA%A2%E6%97%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LucienXian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/01/%E5%9F%BA%E4%BA%8Eopengl%E7%BB%98%E5%88%B6%E4%BA%94%E6%98%9F%E7%BA%A2%E6%97%97/" itemprop="url">基于opengl绘制五星红旗</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-01T17:16:05+08:00">
                2017-10-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="基于opengl绘制五星红旗">基于opengl绘制五星红旗</h1>
<blockquote>
<p>趁着今天是国庆，就更新一下绘制五星红旗的博文吧~祖国万岁</p>
</blockquote>
<figure>
<img src="http://ou7boskhm.bkt.clouddn.com/flag.png" alt="flag" />
<figcaption aria-hidden="true">flag</figcaption>
</figure>
<h2 id="操作步骤">操作步骤</h2>
<h3 id="确定绘制方法">确定绘制方法</h3>
<p>这个实验分为两步，第一步是画出旗面，第二则是根据五角星的位置，画出大小、角度不同的三角形；根据《国旗法》要求，国旗长宽比为3:2，这个画起来难度不大，我们将旗面四个点的位置坐标设置为<strong>(-0.9,0.6)，(0.9,
0.6)，(0.9,-0.6)，(-0.9, -0.6)</strong>。接下来关键是画五角星。</p>
<p>我们来看一下，绘制图形所使用的函数：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">WINGDIAPI <span class="type">void</span> APIENTRY <span class="title">glVertex3f</span> <span class="params">(GLfloat x, GLfloat y, GLfloat z)</span></span>;</span><br></pre></td></tr></table></figure>
<p>由于该函数只能绘制凸多边形，因此我们选择的绘制方法是，将五角星分成多个扇形三角形，然后顺时针逐个绘制三角形，这样能方便我们循环完成，如图：</p>
<figure>
<img src="http://ou7boskhm.bkt.clouddn.com/star1.png" alt="star1" />
<figcaption aria-hidden="true">star1</figcaption>
</figure>
<h3 id="计算相关参数">计算相关参数</h3>
<p>首先是得到各五角星中点的位置，首先是将国旗分为四个小长方形，大五角星的位置为<strong>左五右十，上五下五</strong>，其它各个中心点如图：</p>
<figure>
<img src="http://ou7boskhm.bkt.clouddn.com/xy1.png" alt="xy" />
<figcaption aria-hidden="true">xy</figcaption>
</figure>
<h3 id="绘制三角形">绘制三角形</h3>
<p>根据上面确定的绘制方法，我们需要将五角星分为十个扇形三角形，因此要绘制每个三角形，我们只需要三个参数——中心点，长半径的顶点，短半径的顶点，如图：</p>
<p>根据几何计算，这两个角大小分别为18°和36°</p>
<figure>
<img src="http://ou7boskhm.bkt.clouddn.com/t.png" alt="tan" />
<figcaption aria-hidden="true">tan</figcaption>
</figure>
<p>因此要画出某一个的三角形，必须要得知中心点和其中的一个顶点。然后根据这两个点计算出长半径和短半径，如图，黑线代表长半径R，蓝线代表短半径r；</p>
<figure>
<img src="http://ou7boskhm.bkt.clouddn.com/star2.png" alt="star2" />
<figcaption aria-hidden="true">star2</figcaption>
</figure>
<ul>
<li>首先根据两点之间的距离公式计算出长半径R；</li>
<li>由以上的角度可以计算出：</li>
</ul>
<figure>
<img src="http://ou7boskhm.bkt.clouddn.com/consin1.png" alt="sincos" />
<figcaption aria-hidden="true">sincos</figcaption>
</figure>
<p>接下来，由于我们每个三角形已知的参数中心点和长半径顶点的坐标（也就是已知第一条长半径的旋转角度），因此我们需要据此计算出短半径的坐标位置:</p>
<figure>
<img src="http://ou7boskhm.bkt.clouddn.com/sincos.png" alt="sincos" />
<figcaption aria-hidden="true">sincos</figcaption>
</figure>
<p>而我们又可以得知两边的夹角为36°，因此只需要将将36°带入β中即可求出下一条边的旋转角，如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tempC = cos1*cos36 - sin1*sin36;</span><br><span class="line">tempS = sin1*cos36 + cos1*sin36;</span><br></pre></td></tr></table></figure>
<p>再根据旋转角和长度利用级坐标公式求出x和y的坐标值<strong>(其中midx和midy是五角星中点坐标)</strong>
：</p>
<figure>
<img src="http://ou7boskhm.bkt.clouddn.com/nwdd.png" alt="nwdd" />
<figcaption aria-hidden="true">nwdd</figcaption>
</figure>
<p>代码如下</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">0</span>) &#123; <span class="comment">//偶数下标是外顶点</span></span><br><span class="line">	point[i][<span class="number">0</span>] = l_length*tempC + midx;</span><br><span class="line">	point[i][<span class="number">1</span>] = l_length*tempS + midy;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123; <span class="comment">//奇数下标是内顶点</span></span><br><span class="line">	point[i][<span class="number">0</span>] = s_length*tempC + midx;</span><br><span class="line">	point[i][<span class="number">1</span>] = s_length*tempS + midy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="绘制红旗和五角星">绘制红旗和五角星</h3>
<p>样例代码已经可以绘制出红旗，因此只需要将绘制五角星的过程封装成函数，并传入相关参数即可：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">DrawStar</span>(<span class="number">-0.60</span>, <span class="number">0.30</span>, <span class="number">-0.60</span>, <span class="number">0.48</span>); </span><br><span class="line"><span class="built_in">DrawStar</span>(<span class="number">-0.30</span>, <span class="number">0.48</span>, <span class="number">-0.24</span>, <span class="number">0.48</span>);</span><br><span class="line"><span class="built_in">DrawStar</span>(<span class="number">-0.18</span>, <span class="number">0.36</span>, <span class="number">-0.24</span>, <span class="number">0.36</span>);</span><br><span class="line"><span class="built_in">DrawStar</span>(<span class="number">-0.18</span>, <span class="number">0.18</span>, <span class="number">-0.18</span>, <span class="number">0.24</span>);</span><br><span class="line"><span class="built_in">DrawStar</span>(<span class="number">-0.30</span>, <span class="number">0.06</span>, <span class="number">-0.24</span>, <span class="number">0.06</span>);</span><br></pre></td></tr></table></figure>
<p>并且，在函数中确定绘制颜色为黄色，绘制形状为三角形；</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">glColor3f</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">glBegin</span>(GL_TRIANGLE_FAN);</span><br></pre></td></tr></table></figure>
<h2 id="实验数据记录和处理">实验数据记录和处理</h2>
<p>五星红旗的四个坐标点分别为(-0.9,0.6)，(0.9, 0.6)，(0.9,-0.6)，(-0.9,
-0.6)；</p>
<p>五角星中最大的一个坐标为(-0.60, 0.30)，其余四个分别为(-0.30,
0.48),(-0.18, 0.36), (-0.18, 0.18), (-0.30, 0.06)</p>
<h2 id="实验结果与分析">实验结果与分析</h2>
<h3 id="绘制结果">绘制结果</h3>
<figure>
<img src="http://ou7boskhm.bkt.clouddn.com/res.png" alt="res" />
<figcaption aria-hidden="true">res</figcaption>
</figure>
<h3 id="完整代码">完整代码</h3>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;gl/glut.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> GLfloat PI = <span class="number">3.1415926f</span>;</span><br><span class="line"><span class="type">const</span> GLfloat cos36 = <span class="built_in">cos</span>(PI*<span class="number">0.2</span>);</span><br><span class="line"><span class="type">const</span> GLfloat sin36 = <span class="built_in">sin</span>(PI*<span class="number">0.2</span>);</span><br><span class="line"><span class="type">const</span> GLfloat cos72 = <span class="built_in">cos</span>(PI*<span class="number">0.4</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DrawStar</span><span class="params">(GLfloat midx, GLfloat midy, GLfloat vx, GLfloat vy)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	GLfloat point[<span class="number">11</span>][<span class="number">2</span>]; <span class="comment">//存下所有顶点的位置</span></span><br><span class="line">	GLfloat l_length = <span class="built_in">sqrt</span>((midx - vx)*(midx - vx) + (midy - vy)*(midy - vy));<span class="comment">//计算出顶点长半径的长度</span></span><br><span class="line">	GLfloat s_length = l_length * cos72 / cos36;<span class="comment">//计算出顶点短半径的长度</span></span><br><span class="line">	GLfloat cos1 = (vx - midx) / l_length; <span class="comment">//计算出第一个外接顶点与中心点的三角函数值</span></span><br><span class="line">	GLfloat sin1 = (vy - midy) / l_length;</span><br><span class="line"></span><br><span class="line">	GLfloat tempC, tempS;</span><br><span class="line">	point[<span class="number">0</span>][<span class="number">0</span>] = vx, point[<span class="number">0</span>][<span class="number">1</span>] = vy;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; <span class="number">11</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		tempC = cos1*cos36 - sin1*sin36;</span><br><span class="line">		tempS = sin1*cos36 + cos1*sin36;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">0</span>) &#123; <span class="comment">//偶数下标是外顶点</span></span><br><span class="line">			point[i][<span class="number">0</span>] = l_length*tempC + midx;</span><br><span class="line">			point[i][<span class="number">1</span>] = l_length*tempS + midy;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123; <span class="comment">//奇数下标是内顶点</span></span><br><span class="line">			point[i][<span class="number">0</span>] = s_length*tempC + midx;</span><br><span class="line">			point[i][<span class="number">1</span>] = s_length*tempS + midy;</span><br><span class="line">		&#125;</span><br><span class="line">		cos1 = tempC;</span><br><span class="line">		sin1 = tempS;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glColor3f</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glBegin</span>(GL_TRIANGLE_FAN);</span><br><span class="line">	<span class="built_in">glVertex3f</span>(midx, midy, <span class="number">0.5</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">11</span>; i++)</span><br><span class="line">		<span class="built_in">glVertex3f</span>(point[i][<span class="number">0</span>], point[i][<span class="number">1</span>], <span class="number">0.5</span>); <span class="comment">//绘制三角形</span></span><br><span class="line">	<span class="built_in">glEnd</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glColor3f</span>(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glBegin</span>(GL_QUADS);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glVertex3f</span>(<span class="number">-0.9</span>, <span class="number">0.6</span>, <span class="number">0.5</span>);</span><br><span class="line">	<span class="built_in">glVertex3f</span>(<span class="number">0.9</span>, <span class="number">0.6</span>, <span class="number">0.5</span>);</span><br><span class="line">	<span class="built_in">glVertex3f</span>(<span class="number">0.9</span>, <span class="number">-0.6</span>, <span class="number">0.5</span>);</span><br><span class="line">	<span class="built_in">glVertex3f</span>(<span class="number">-0.9</span>, <span class="number">-0.6</span>, <span class="number">0.5</span>); <span class="comment">//旗面长宽比为3：2</span></span><br><span class="line">	<span class="built_in">glEnd</span>();</span><br><span class="line"></span><br><span class="line">	<span class="built_in">DrawStar</span>(<span class="number">-0.60</span>, <span class="number">0.30</span>, <span class="number">-0.60</span>, <span class="number">0.48</span>); </span><br><span class="line">	<span class="built_in">DrawStar</span>(<span class="number">-0.30</span>, <span class="number">0.48</span>, <span class="number">-0.24</span>, <span class="number">0.48</span>);</span><br><span class="line">	<span class="built_in">DrawStar</span>(<span class="number">-0.18</span>, <span class="number">0.36</span>, <span class="number">-0.24</span>, <span class="number">0.36</span>);</span><br><span class="line">	<span class="built_in">DrawStar</span>(<span class="number">-0.18</span>, <span class="number">0.18</span>, <span class="number">-0.18</span>, <span class="number">0.24</span>);</span><br><span class="line">	<span class="built_in">DrawStar</span>(<span class="number">-0.30</span>, <span class="number">0.06</span>, <span class="number">-0.24</span>, <span class="number">0.06</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glutSwapBuffers</span>(); <span class="comment">//交换缓冲区</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">(<span class="type">int</span> argc,  <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glutInit</span>(&amp;argc,argv);</span><br><span class="line">	<span class="built_in">glutInitDisplayMode</span>(GLUT_RGB | GLUT_DOUBLE);</span><br><span class="line">	<span class="built_in">glutInitWindowPosition</span>(<span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">	<span class="built_in">glutInitWindowSize</span>(<span class="number">400</span>, <span class="number">300</span>);</span><br><span class="line">	<span class="built_in">glutCreateWindow</span>(<span class="string">&quot;National Flag&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glutDisplayFunc</span>(display);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glutMainLoop</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="心得">心得</h2>
<p>这是第一个图形学实验，让我好好回顾了一下三角函数的公式，总体花的时间不是特别多。其中犯的比较大的错误是在计算下一个顶点的旋转角的三角函数时，我没有替代原来的变量，而是在一次循环中直接在计算出正弦角后马上将新的正弦角带入计算余弦角，最后画出了一个不成形的五角星。好在最后找到了这个bug并成功修复。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/25/Bresenham-s-line-algorithm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LucienXian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/25/Bresenham-s-line-algorithm/" itemprop="url">Bresenham's line algorithm</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-25T13:38:40+08:00">
                2017-09-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="introduction">Introduction</h1>
<p>计算机图形学课上介绍了一个由两点所决定的直线的算法——<strong>Bresenham
算法</strong> ；</p>
<p>这个算法用到了快速的整数加法，减法和位元移位，是计算机图形里面描绘直线的较为快速的算法。</p>
<p>首先来介绍一下，绘制直线的基本方法:</p>
<blockquote>
<p>假设我们需要由(<em>x</em>0,
<em>y</em>0)这一点，绘画一直线至右下角的另一点(<em>x</em>1,
<em>y</em>1)，x,y分别代表其水平及垂直坐标，并且<em>x</em>1 - <em>x</em>0
&gt; <em>y</em>1 - <em>y</em>0。</p>
<p>因为像素点需要的x及y皆为整数，但并非每一点x所对应的y皆为整数，因此没有必要去计算每一点x所对应之y值。反之由于此线的斜率介乎于1至0之间，因此我们只需要找出当x到达那一个数值时，会使y上升1，若x尚未到此值，则y不变。至于如何找出相关的x值，则需依靠斜率。斜率之计算方法为<img
src="https://wikimedia.org/api/rest_v1/media/math/render/svg/387e6bb11041b587f22a579d6023dccac395e395"
alt="m=(y_{1}-y_{0})/(x_{1}-x_{0})" />。由于此值不变，故可于运算前预先计算，减少运算次数。</p>
</blockquote>
<figure>
<img src="http://ou7boskhm.bkt.clouddn.com/B_alg.png" alt="如图" />
<figcaption aria-hidden="true">如图</figcaption>
</figure>
<p><br></p>
<h1 id="problem">Problem</h1>
<p>但这里遇到了一个问题，由于计算机图形学对速度要求较高，而上面提到的算法中用到了大量的浮点运算；而且，经过大量的浮点运算，误差会被大量积累。因此为了避免这种情况发生，应该将浮点运算转换为整数运算。</p>
<p>因此就引入了这种算法：<strong>Bresenham's line algorithm</strong></p>
<ul>
<li>首先来看这张图：</li>
</ul>
<figure>
<img src="http://ou7boskhm.bkt.clouddn.com/line.png" alt="line" />
<figcaption aria-hidden="true">line</figcaption>
</figure>
<ul>
<li>由此可见，每次xi增加时，yi都有两个选择：<em>y(i+1) =yi or y(i+1) =yi
+ 1</em>；因此我们需要比较d1和d2的大小：
<ul>
<li><em>y = m(xi + 1) + b</em><br />
</li>
<li><em>d1 = y - yi</em></li>
<li><em>d2 = yi + 1 - y</em></li>
<li>If <em>d1-d2 &gt; 0</em>，then <em>y(i+1)=yi + 1</em>，else <em>yi+1
= yi</em></li>
</ul></li>
<li>根据上面的式子和m = dy/dx (dy = y1 - y0；dx = x1 -
x0)，我们可以计算得：
<ul>
<li><em>d1-d2= 2y - 2yi - 1= 2dy/dx</em>xi + 2dy/dx + 2b - 2yi - 1*</li>
</ul></li>
<li><strong>关键点</strong>来了，为了避免浮点数运算，我们在两边乘以dx；假设
dx*(d1-d2) = Pi:
<ul>
<li><em>Pi = 2xidy - 2yidx + 2dy + (2b-1)dx</em></li>
<li>同理：<em>P(i+1) = 2x(i+1)dy - 2y(i+1)dx + 2dy + (2b-1)dx</em></li>
</ul></li>
</ul>
<blockquote>
<p>这时，当Pi &gt; 0，下一个y取 yi + 1，否则还是yi；</p>
</blockquote>
<ul>
<li>因此我们可以得到一个<strong>增量函数</strong>：<em>P(i+1) =
Pi+2dy-2(y(i+1)-yi)dx</em>;</li>
<li>既然是增量函数：我们要求起始P0：
<ul>
<li>由上面的式子，<em>P0 = 2x0dy - 2y0dx + 2dy + (2b-1)dx</em>；</li>
<li>两边除以dx，得到 <em>P0/dx = 2x0m - 2y0 + 2m + (2b-1)</em>；</li>
<li>结合: <em>2x0m - 2y0 + 2b = 0</em>，得到<em>P0 = 2mdx - dx = 2dy -
dx</em> ；</li>
</ul></li>
</ul>
<blockquote>
<p>以上就是，我们对此算法的推导，通过整数运算，移位等，根据Pi的正负，即可快速描绘出直线；</p>
</blockquote>
<h1 id="pseudocode">Pseudocode</h1>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function <span class="title function_">line</span><span class="params">(x0, x1, y0, y1)</span><span class="comment">//假设x0 &lt; x1; y0 &lt; y1</span></span><br><span class="line">    <span class="title function_">draw</span><span class="params">(x0, y0)</span>，dx=x1-x0，dy=y1-y0</span><br><span class="line">    <span class="type">int</span> P0 := <span class="number">2</span>dy - dx</span><br><span class="line">    <span class="keyword">for</span> x from x0 to x1</span><br><span class="line">       <span class="keyword">if</span> Pi&gt;<span class="number">0</span>，then y(i+<span class="number">1</span>) = yi+<span class="number">1</span>，<span class="keyword">else</span> y(i+<span class="number">1</span>) = yi；</span><br><span class="line">	draw(x(i+<span class="number">1</span>), y(i+<span class="number">1</span>))</span><br><span class="line">	<span class="keyword">if</span> Pi&gt;<span class="number">0</span>，then P(i+<span class="number">1</span>) = Pi + <span class="number">2</span>dy - <span class="number">2</span>dx，<span class="keyword">else</span> P(i+<span class="number">1</span>) = Pi + <span class="number">2</span>dy；<span class="comment">//calculate P(i+1)</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p>至于线段方向改变等问题，则只要交换x和y即可；</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/26/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><span class="page-number current">27</span><a class="page-number" href="/page/28/">28</a><a class="extend next" rel="next" href="/page/28/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="" />
          <p class="site-author-name" itemprop="name"></p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">276</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">29</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LucienXian</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" target="_blank" rel="noopener" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
